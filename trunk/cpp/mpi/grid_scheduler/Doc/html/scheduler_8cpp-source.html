<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Grid schduling Simulation sequential: UvA Files/Distributed Stochastic Simulation/Grid_Scheduling_Wood_Koulouzis/src/scheduler_MPI/scheduler.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>UvA Files/Distributed Stochastic Simulation/Grid_Scheduling_Wood_Koulouzis/src/scheduler_MPI/scheduler.cpp</h1><a href="scheduler_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *   Copyright (C) 2007 by S. Koulouzis, T. Wood   *</span>
<a name="l00003"></a>00003 <span class="comment"> *   skoulouz@science.uva.nl   *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                         *</span>
<a name="l00005"></a>00005 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00006"></a>00006 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00007"></a>00007 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00008"></a>00008 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00009"></a>00009 <span class="comment"> *                                                                         *</span>
<a name="l00010"></a>00010 <span class="comment"> *   This program is distributed in the hope that it will be useful,       *</span>
<a name="l00011"></a>00011 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *</span>
<a name="l00012"></a>00012 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *</span>
<a name="l00013"></a>00013 <span class="comment"> *   GNU General Public License for more details.                          *</span>
<a name="l00014"></a>00014 <span class="comment"> *                                                                         *</span>
<a name="l00015"></a>00015 <span class="comment"> *   You should have received a copy of the GNU General Public License     *</span>
<a name="l00016"></a>00016 <span class="comment"> *   along with this program; if not, write to the                         *</span>
<a name="l00017"></a>00017 <span class="comment"> *   Free Software Foundation, Inc.,                                       *</span>
<a name="l00018"></a>00018 <span class="comment"> *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *</span>
<a name="l00019"></a>00019 <span class="comment"> ***************************************************************************/</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="comment">// cluster/workspace/SESP/debug/src/notThis; mpirun.globus -n 2 /cluster/workspace/SESP/debug/src/sesp -r 100 -p 200 -b 6</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include "mpi.h"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="definitions_8h.html">definitions.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="island_8h.html">island.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="grid_8h.html">grid.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#0d5f32e277578aaab794784d30bfe53d">parseargs</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);
<a name="l00031"></a><a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">00031</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>;
<a name="l00032"></a><a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">00032</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>;
<a name="l00033"></a><a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">00033</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a>,<a class="code" href="scheduler_8cpp.html#5ec6ed8fc02fba98e9b6a5bfc098cf52">localPopulationSize</a>;
<a name="l00034"></a><a class="code" href="scheduler_8cpp.html#775af73636d0d260322bc971582ffd7a">00034</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#775af73636d0d260322bc971582ffd7a">popInitMethod</a>;<span class="comment">//the way the population is initialised</span>
<a name="l00035"></a><a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">00035</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">fitnessType</a>;<span class="comment">//the fitness type used to evaluate candidates</span>
<a name="l00036"></a><a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">00036</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">maxTasks</a>;
<a name="l00037"></a><a class="code" href="scheduler_8cpp.html#3f1f91bcfdd5e5fa5af6a1887c28c490">00037</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#3f1f91bcfdd5e5fa5af6a1887c28c490">numTasks</a>;
<a name="l00038"></a><a class="code" href="scheduler_8cpp.html#51233728f0f424bd44b30d50f54579a4">00038</a> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#51233728f0f424bd44b30d50f54579a4">startwtime</a> = 0.0;
<a name="l00039"></a><a class="code" href="scheduler_8cpp.html#58d76b19928bb7b37adbb4f4ba9d2ad5">00039</a> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#58d76b19928bb7b37adbb4f4ba9d2ad5">endwtime</a>=0.0;
<a name="l00040"></a><a class="code" href="scheduler_8cpp.html#bc276e47b85df9dd59f248e663b3b971">00040</a> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#bc276e47b85df9dd59f248e663b3b971">total_time</a>=0.0;
<a name="l00041"></a>00041 <span class="comment">// int arguments[6];</span>
<a name="l00042"></a><a class="code" href="scheduler_8cpp.html#24022e0fd472b4af3eafbdd9288c723d">00042</a> <a class="code" href="classGrid.html">Grid</a> *<a class="code" href="scheduler_8cpp.html#24022e0fd472b4af3eafbdd9288c723d">g</a>;
<a name="l00043"></a><a class="code" href="scheduler_8cpp.html#9f8d76900d726d1df9a89a9a32529e3e">00043</a> <a class="code" href="classIsland.html">Island</a> *<a class="code" href="scheduler_8cpp.html#9f8d76900d726d1df9a89a9a32529e3e">island</a>;
<a name="l00044"></a><a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">00044</a> <a class="code" href="definitions_8h.html#2c7eb15763e8941095e64daa3157f898">ResourceList</a> <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>;
<a name="l00045"></a>00045 <span class="comment">//MPI stuff</span>
<a name="l00046"></a><a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">00046</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a>, <a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>;
<a name="l00047"></a>00047 <span class="comment">//MPI data type describing the resource</span>
<a name="l00048"></a><a class="code" href="scheduler_8cpp.html#0a5ea0a4ae5925f407b86a980f86c168">00048</a> MPI_Datatype <a class="code" href="scheduler_8cpp.html#0a5ea0a4ae5925f407b86a980f86c168">Gresource_type</a>;
<a name="l00049"></a>00049 <span class="comment">/*The arrays to fill and pass as arguments to MPI_Type_struct */</span>
<a name="l00050"></a><a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">00050</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[5];
<a name="l00051"></a><a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">00051</a> MPI_Aint <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[5];
<a name="l00052"></a><a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">00052</a> MPI_Datatype <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[5];
<a name="l00053"></a><a class="code" href="scheduler_8cpp.html#5311af16466c2bfdcd4d821fa93213c5">00053</a> MPI_Status <a class="code" href="scheduler_8cpp.html#5311af16466c2bfdcd4d821fa93213c5">status</a>;
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="scheduler_8cpp.html#1ace4f04b83d280042a8df19a025ed86">00055</a> <a class="code" href="structGresource.html">Gresource</a> <a class="code" href="scheduler_8cpp.html#1ace4f04b83d280042a8df19a025ed86">ress</a>[99999];
<a name="l00056"></a><a class="code" href="scheduler_8cpp.html#788f997b784dad497b3736fe28c11441">00056</a> <span class="keywordtype">int</span> *<a class="code" href="scheduler_8cpp.html#788f997b784dad497b3736fe28c11441">schdulesIn</a>;
<a name="l00057"></a><a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">00057</a> <span class="keywordtype">int</span> *<a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">schdulesOut</a>;
<a name="l00058"></a><a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">00058</a> <a class="code" href="definitions_8h.html#49d99d5115ac14e37e46ca5ce277ebe0">Schedule</a> <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>;
<a name="l00059"></a><a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">00059</a> vector&lt;Schedule&gt; <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>;
<a name="l00060"></a><a class="code" href="scheduler_8cpp.html#40d16bd2d0e4b1d33d7ba8327dc1bb84">00060</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#40d16bd2d0e4b1d33d7ba8327dc1bb84">nprocsX</a>;
<a name="l00061"></a><a class="code" href="scheduler_8cpp.html#27350ea38d36477680af7c6a8b8d7c57">00061</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#27350ea38d36477680af7c6a8b8d7c57">nprocsY</a>;
<a name="l00062"></a><a class="code" href="scheduler_8cpp.html#2c2f810d1261b151f4e2159f9412d1a2">00062</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#9b908a290e469965b0988ee6ab9782dd">dims</a>[2], <a class="code" href="scheduler_8cpp.html#2c2f810d1261b151f4e2159f9412d1a2">periods</a>[2], <a class="code" href="scheduler_8cpp.html#75550a3b9f4547372b09aa2f0f1e9941">coords</a>[2], <a class="code" href="scheduler_8cpp.html#a5c9fb06d60f506ecb804a1bdcd4ad14">neighbour</a>[2];
<a name="l00063"></a><a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">00063</a> <span class="keyword">static</span> MPI_Comm <a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>; 
<a name="l00064"></a><a class="code" href="scheduler_8cpp.html#036fdc4f6092f7315bbebcb44c4982f8">00064</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#036fdc4f6092f7315bbebcb44c4982f8">myLeft</a>;         <span class="comment">/* rank of left mpi process in grid/line topology       */</span>
<a name="l00065"></a><a class="code" href="scheduler_8cpp.html#258abea066f11bbfcf28833da17afeb8">00065</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#258abea066f11bbfcf28833da17afeb8">myRight</a>;        <span class="comment">/* rank of right mpi process in grid/line topology      */</span>
<a name="l00066"></a><a class="code" href="scheduler_8cpp.html#d407e1c2ea8fde82dfeb8d4347670c2b">00066</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#d407e1c2ea8fde82dfeb8d4347670c2b">myUp</a>;                <span class="comment">/* rank of up mpi process in grid/line topology      */</span>
<a name="l00067"></a><a class="code" href="scheduler_8cpp.html#254ffb4f3cc2f5a835c77e206e8863d5">00067</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#254ffb4f3cc2f5a835c77e206e8863d5">myDown</a>;      <span class="comment">/* rank of down mpi process in grid/line topology      */</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="comment">/*Performance measures*/</span>
<a name="l00070"></a><a class="code" href="scheduler_8cpp.html#b24f4b67315cc6f87f22c7905ab77142">00070</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#b24f4b67315cc6f87f22c7905ab77142">reporter</a>;
<a name="l00071"></a><a class="code" href="scheduler_8cpp.html#de0ceadb48acaa46f1f5f4db95df8d6e">00071</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#de0ceadb48acaa46f1f5f4db95df8d6e">t_init</a>=0.0;
<a name="l00072"></a><a class="code" href="scheduler_8cpp.html#375993e418df2c81fa167cccb5d884d4">00072</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#375993e418df2c81fa167cccb5d884d4">t_comp</a>=0.0;
<a name="l00073"></a><a class="code" href="scheduler_8cpp.html#6f471a3702724cb32c3cd609f7241bcf">00073</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#6f471a3702724cb32c3cd609f7241bcf">t_compRunGA</a>=0.0;
<a name="l00074"></a><a class="code" href="scheduler_8cpp.html#014de8ec15bba8715d91d3eb6eb92cef">00074</a> <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#014de8ec15bba8715d91d3eb6eb92cef">t_comm</a>=0.0;
<a name="l00075"></a><a class="code" href="scheduler_8cpp.html#009f46a8434d3bd8e4a6794245377cb2">00075</a> <span class="keyword">static</span>  <span class="keywordtype">double</span> <a class="code" href="scheduler_8cpp.html#009f46a8434d3bd8e4a6794245377cb2">td</a>=0.0;
<a name="l00076"></a><a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">00076</a> <span class="keyword">static</span>  <span class="keywordtype">long</span> <a class="code" href="scheduler_8cpp.html#e730cf043720ac0a7b94c64e7356d9ec">sec</a>,<a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">usec</a>;
<a name="l00077"></a><a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">00077</a> <span class="keyword">static</span>  <span class="keyword">struct </span>timeval <a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00085"></a><a class="code" href="scheduler_8cpp.html#e5df1a67ff8bf41dffc7ade8fbac38cf">00085</a> vector&lt;double&gt; <a class="code" href="scheduler_8cpp.html#e5df1a67ff8bf41dffc7ade8fbac38cf">getBatch</a>(<span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>) {
<a name="l00086"></a>00086         
<a name="l00087"></a>00087         vector&lt;double&gt; batch;
<a name="l00088"></a>00088         <span class="keywordtype">double</span> mi;
<a name="l00089"></a>00089         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; batchSize; i++) {
<a name="l00090"></a>00090                 mi = double(random()) / double(RAND_MAX) * 500;
<a name="l00091"></a>00091                 batch.push_back(mi);
<a name="l00092"></a>00092                 <a class="code" href="scheduler_8cpp.html#3f1f91bcfdd5e5fa5af6a1887c28c490">numTasks</a>++;
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">//      cout &lt;&lt; "Main @" &lt;&lt; myrank &lt;&lt; ":\n  -created batch with " &lt;&lt; batch.size() &lt;&lt; " tasks " &lt;&lt; " total tasks: " &lt;&lt; numTasks &lt;&lt; endl;</span>
<a name="l00096"></a>00096         
<a name="l00097"></a>00097         <span class="keywordflow">return</span> batch;
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="scheduler_8cpp.html#d091007e4eadc8c285dc75c46b5e9261">00100</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#d091007e4eadc8c285dc75c46b5e9261">refreshGridResourceList</a>(){
<a name="l00101"></a>00101         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00102"></a>00102                 <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.clear();
<a name="l00103"></a>00103                 <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a> = g-&gt;<a class="code" href="classGrid.html#5a1a2461b5e1654269bf138204883f9e">getResourceList</a>();
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="comment">//why? - for output stupid!!!</span>
<a name="l00108"></a><a class="code" href="scheduler_8cpp.html#7c7a763fb2da35e937e10e35ae3d061a">00108</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#7c7a763fb2da35e937e10e35ae3d061a">getGaIterations</a>(){
<a name="l00109"></a>00109         <span class="keywordtype">int</span> iters = island-&gt;<a class="code" href="classIsland.html#15463c72f4b3c497cdf9044a9bc15072">getIterations</a>();
<a name="l00110"></a>00110         <span class="keywordflow">return</span> iters;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="scheduler_8cpp.html#0fcb2205a2bd023d3d00a55f0cf487b1">00114</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#0fcb2205a2bd023d3d00a55f0cf487b1">initResourceStruct</a>(){
<a name="l00115"></a>00115         <span class="comment">/*Putting each element of struct params into the new datatype... */</span>
<a name="l00116"></a>00116         <span class="comment">//resource ID</span>
<a name="l00117"></a>00117         <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[0] = 1;
<a name="l00118"></a>00118         <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[0] = 0;
<a name="l00119"></a>00119         <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[0] = MPI_INT;
<a name="l00120"></a>00120         
<a name="l00121"></a>00121         <span class="comment">//resource mips</span>
<a name="l00122"></a>00122         <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[1] = 1;
<a name="l00123"></a>00123         <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[1] =  <span class="keyword">sizeof</span>(int);
<a name="l00124"></a>00124         <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[1] = MPI_DOUBLE;
<a name="l00125"></a>00125         
<a name="l00126"></a>00126         <span class="comment">//resource requests     </span>
<a name="l00127"></a>00127         <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[2] = 1;
<a name="l00128"></a>00128         <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[2] = <span class="keyword">sizeof</span>(int) + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>);
<a name="l00129"></a>00129         <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[2] = MPI_DOUBLE;
<a name="l00130"></a>00130         
<a name="l00131"></a>00131         <span class="comment">//resource load</span>
<a name="l00132"></a>00132         <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[3] = 1;
<a name="l00133"></a>00133         <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[3] = <span class="keyword">sizeof</span>(int) + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) + <span class="keyword">sizeof</span>(double);
<a name="l00134"></a>00134         <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[3] = MPI_DOUBLE;
<a name="l00135"></a>00135         
<a name="l00136"></a>00136         <span class="comment">//reliability</span>
<a name="l00137"></a>00137         <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>[4] = 1;
<a name="l00138"></a>00138         <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>[4] = <span class="keyword">sizeof</span>(int) + <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)+ <span class="keyword">sizeof</span>(double)+ <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>);
<a name="l00139"></a>00139         <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>[4] = MPI_DOUBLE;
<a name="l00140"></a>00140         
<a name="l00141"></a>00141         <span class="comment">/*finally, create the datatype and commit changes!*/</span>
<a name="l00142"></a>00142         MPI_Type_struct( 5, <a class="code" href="scheduler_8cpp.html#0bffba35b029a7e633a15f5363431b90">blocklens</a>, <a class="code" href="scheduler_8cpp.html#e8cf30dc831d90d5a6ae9e6b2fd1e880">displs</a>, <a class="code" href="scheduler_8cpp.html#eb315649b03799e9725aaab7a52f0f68">oldtypes</a>, &amp;<a class="code" href="scheduler_8cpp.html#0a5ea0a4ae5925f407b86a980f86c168">Gresource_type</a> );
<a name="l00143"></a>00143         MPI_Type_commit( &amp;<a class="code" href="scheduler_8cpp.html#0a5ea0a4ae5925f407b86a980f86c168">Gresource_type</a> );
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a><a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">00146</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>(){
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0)  
<a name="l00149"></a>00149         {
<a name="l00150"></a>00150                 <span class="keywordflow">if</span>(gettimeofday(&amp;<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>,NULL)==0){
<a name="l00151"></a>00151                 <span class="comment">/* Record the first point of time */</span>
<a name="l00152"></a>00152                 <a class="code" href="scheduler_8cpp.html#e730cf043720ac0a7b94c64e7356d9ec">sec</a>=<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>.tv_sec; <a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">usec</a>=<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>.tv_usec; 
<a name="l00153"></a>00153         
<a name="l00154"></a>00154                 }
<a name="l00155"></a>00155                 <span class="keywordflow">else</span>
<a name="l00156"></a>00156                 {
<a name="l00157"></a>00157                 perror(<span class="stringliteral">"Can not get Wall-Clock time!\n"</span>);
<a name="l00158"></a>00158                 MPI_Abort(MPI_COMM_WORLD,EXIT_FAILURE); 
<a name="l00159"></a>00159                 }
<a name="l00160"></a>00160         }
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">00163</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(<span class="keywordtype">int</span> what){
<a name="l00164"></a>00164         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0)
<a name="l00165"></a>00165         {
<a name="l00166"></a>00166                 <span class="keywordflow">if</span>(gettimeofday(&amp;<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>,NULL)==0){
<a name="l00167"></a>00167                         <a class="code" href="scheduler_8cpp.html#e730cf043720ac0a7b94c64e7356d9ec">sec</a>=<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>.tv_sec-<a class="code" href="scheduler_8cpp.html#e730cf043720ac0a7b94c64e7356d9ec">sec</a>; 
<a name="l00168"></a>00168                         <a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">usec</a>=<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>.tv_usec-<a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">usec</a>; 
<a name="l00169"></a>00169                         <span class="comment">/* Get the second point of time */</span>
<a name="l00170"></a>00170                         <a class="code" href="scheduler_8cpp.html#009f46a8434d3bd8e4a6794245377cb2">td</a>=<a class="code" href="scheduler_8cpp.html#e730cf043720ac0a7b94c64e7356d9ec">sec</a>+<a class="code" href="scheduler_8cpp.html#63e59ad14d61e70117ccdf2b9cf4d577">usec</a>/1.0e6;
<a name="l00171"></a>00171                         <span class="comment">/* Calculate the time difference and print it out */</span>
<a name="l00172"></a>00172                         <span class="keywordflow">switch</span>(what){
<a name="l00173"></a>00173                                 <span class="keywordflow">case</span> 0:
<a name="l00174"></a>00174                                         <a class="code" href="scheduler_8cpp.html#014de8ec15bba8715d91d3eb6eb92cef">t_comm</a> = <a class="code" href="scheduler_8cpp.html#014de8ec15bba8715d91d3eb6eb92cef">t_comm</a>+<a class="code" href="scheduler_8cpp.html#009f46a8434d3bd8e4a6794245377cb2">td</a>;
<a name="l00175"></a>00175                                 <span class="keywordflow">break</span>;
<a name="l00176"></a>00176                                 <span class="keywordflow">case</span> 1:
<a name="l00177"></a>00177                                         <a class="code" href="scheduler_8cpp.html#375993e418df2c81fa167cccb5d884d4">t_comp</a> = <a class="code" href="scheduler_8cpp.html#375993e418df2c81fa167cccb5d884d4">t_comp</a>+td;
<a name="l00178"></a>00178                                 <span class="keywordflow">break</span>;
<a name="l00179"></a>00179                                 <span class="keywordflow">case</span> 2:
<a name="l00180"></a>00180                                         <a class="code" href="scheduler_8cpp.html#6f471a3702724cb32c3cd609f7241bcf">t_compRunGA</a>=<a class="code" href="scheduler_8cpp.html#6f471a3702724cb32c3cd609f7241bcf">t_compRunGA</a>+td;
<a name="l00181"></a>00181                                 <span class="keywordflow">break</span>;
<a name="l00182"></a>00182                                 <span class="keywordflow">default</span> :
<a name="l00183"></a>00183                                         <a class="code" href="scheduler_8cpp.html#de0ceadb48acaa46f1f5f4db95df8d6e">t_init</a> =<a class="code" href="scheduler_8cpp.html#de0ceadb48acaa46f1f5f4db95df8d6e">t_init</a> + td;
<a name="l00184"></a>00184                                 <span class="keywordflow">break</span>;
<a name="l00185"></a>00185                         }
<a name="l00186"></a>00186                         
<a name="l00187"></a>00187                 }<span class="keywordflow">else</span>{
<a name="l00188"></a>00188                         perror(<span class="stringliteral">"Can not get Wall-Clock time!\n"</span>);
<a name="l00189"></a>00189                         MPI_Abort(MPI_COMM_WORLD,EXIT_FAILURE); 
<a name="l00190"></a>00190                         }
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192         
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="scheduler_8cpp.html#1228f68b540116b0efd3d19a1353f732">00195</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#1228f68b540116b0efd3d19a1353f732">packAndBroadcastResourceList</a>(){
<a name="l00196"></a>00196 <span class="comment">//      ress = new Gresource[numResources];</span>
<a name="l00197"></a>00197         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00198"></a>00198                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>;i++){
<a name="l00199"></a>00199                         ress[i].<a class="code" href="structGresource.html#5dd571d5d16366d5b98a204c2c63a142">id</a> =  <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.at(i).id;
<a name="l00200"></a>00200                         ress[i].<a class="code" href="structGresource.html#f58f076b8e28a8692585f815324ca80b">mips</a> = <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.at(i).mips;
<a name="l00201"></a>00201                         ress[i].<a class="code" href="structGresource.html#ba638d9de6f60a91979f8c271e1aa801">requests</a> = <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.at(i).requests;
<a name="l00202"></a>00202                         ress[i].<a class="code" href="structGresource.html#b7bf76acc1fae98738031dc45f24c5c2">load</a> = <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.at(i).load;
<a name="l00203"></a>00203                         ress[i].<a class="code" href="structGresource.html#08050b4299030bdf297ac6e6ce49d668">reliability</a> =  <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.at(i).reliability;
<a name="l00204"></a>00204                 }
<a name="l00205"></a>00205 <span class="comment">//              cout &lt;&lt;"rank:"  &lt;&lt; myrank &lt;&lt; " ress[0].mips = " &lt;&lt; ress[0].mips &lt;&lt; endl;</span>
<a name="l00206"></a>00206 <span class="comment">//              MPI_Send(ress1, numResources , Gresource_type, 1, 123, grid);   </span>
<a name="l00207"></a>00207         }
<a name="l00208"></a>00208         MPI_Bcast( &amp;ress, <a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>, <a class="code" href="scheduler_8cpp.html#0a5ea0a4ae5925f407b86a980f86c168">Gresource_type</a>, 0,MPI_COMM_WORLD );
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="scheduler_8cpp.html#4d3f97593b9627d0b198ebaf0d01199e">00211</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#4d3f97593b9627d0b198ebaf0d01199e">unpackResourceList</a>(){
<a name="l00212"></a>00212         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>!=0){
<a name="l00213"></a>00213         <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.clear();
<a name="l00214"></a>00214                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>;i++){
<a name="l00215"></a>00215                         <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>.push_back(ress[i]);
<a name="l00216"></a>00216                 }
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218 <span class="comment">//      cout &lt;&lt;"rank:"  &lt;&lt; myrank &lt;&lt; " gridResourceList.at(0).mips  = " &lt;&lt; gridResourceList.at(0).mips  &lt;&lt; endl;</span>
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="scheduler_8cpp.html#e64900c0f605f0ddc2b5de92d4c96d74">00221</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#e64900c0f605f0ddc2b5de92d4c96d74">gatherSchdules</a>(){
<a name="l00222"></a>00222         <span class="comment">//allocat memory for the send buffer, and unpack schdules returned from the GA</span>
<a name="l00223"></a>00223         <a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">schdulesOut</a> = (<span class="keywordtype">int</span> *)malloc( (<a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.size()) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00224"></a>00224         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.size();i++){
<a name="l00225"></a>00225                 <a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">schdulesOut</a>[i] = <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.at(i);
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00228"></a>00228                 <a class="code" href="scheduler_8cpp.html#788f997b784dad497b3736fe28c11441">schdulesIn</a> = (<span class="keywordtype">int</span> *)malloc( (<a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a> * <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.size()) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00229"></a>00229                 <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.clear();
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         MPI_Gather(<a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">schdulesOut</a>, <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.size(), MPI_INT, <a class="code" href="scheduler_8cpp.html#788f997b784dad497b3736fe28c11441">schdulesIn</a>, <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.size() , MPI_INT, 0, MPI_COMM_WORLD);
<a name="l00232"></a>00232         
<a name="l00233"></a>00233         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00234"></a>00234                 <span class="keywordtype">int</span> counter=0;
<a name="l00235"></a>00235                 <a class="code" href="definitions_8h.html#49d99d5115ac14e37e46ca5ce277ebe0">Schedule</a> tempSchedule(<a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>);
<a name="l00236"></a>00236                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; <a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a> * <a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>;i++){
<a name="l00237"></a>00237                         <span class="keywordflow">if</span>(counter == (batchSize) ){                    
<a name="l00238"></a>00238                                 counter = 0;
<a name="l00239"></a>00239                                 <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.push_back(tempSchedule);
<a name="l00240"></a>00240                         }
<a name="l00241"></a>00241                         tempSchedule.at(counter) = schdulesIn[i];
<a name="l00242"></a>00242                         counter++;
<a name="l00243"></a>00243                         <span class="comment">//add the last schedule</span>
<a name="l00244"></a>00244                         <span class="keywordflow">if</span>(i == (<a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a> * batchSize) - 1){
<a name="l00245"></a>00245                                 <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.push_back(tempSchedule);
<a name="l00246"></a>00246                         }
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248 <span class="comment">//              cout &lt;&lt;  endl;</span>
<a name="l00249"></a>00249 <span class="comment">//              for(int i=0;i&lt;returnedSchedules.size();i++){</span>
<a name="l00250"></a>00250 <span class="comment">//                      tempSchedule.clear();</span>
<a name="l00251"></a>00251 <span class="comment">//                      tempSchedule = returnedSchedules.at(i);</span>
<a name="l00252"></a>00252 <span class="comment">//                      cout &lt;&lt; " schedule vector " &lt;&lt;  i &lt;&lt; endl;</span>
<a name="l00253"></a>00253 <span class="comment">//                      for(int j=0;j&lt;tempSchedule.size();j++){</span>
<a name="l00254"></a>00254 <span class="comment">//                              cout &lt;&lt; "       " &lt;&lt; tempSchedule.at(j) &lt;&lt; endl;</span>
<a name="l00255"></a>00255 <span class="comment">//                      }</span>
<a name="l00256"></a>00256 <span class="comment">//              }</span>
<a name="l00257"></a>00257         }       
<a name="l00258"></a>00258         free(<a class="code" href="scheduler_8cpp.html#bbbd8f89c8e97717334e682e9124c340">schdulesOut</a>);
<a name="l00259"></a>00259         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00260"></a>00260                 free(schdulesIn);
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="scheduler_8cpp.html#e0057189546a347c2f0b8eb30a0ea591">00264</a> <a class="code" href="definitions_8h.html#49d99d5115ac14e37e46ca5ce277ebe0">Schedule</a> <a class="code" href="scheduler_8cpp.html#e0057189546a347c2f0b8eb30a0ea591">getBestSchedules</a>(<span class="keywordtype">int</span> kinOfFitness){
<a name="l00265"></a>00265         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00266"></a>00266                 <span class="keywordtype">double</span> fitness=<a class="code" href="definitions_8h.html#aa1ac5caef84256eaeb39594e58e096f">MAX_INT</a>;
<a name="l00267"></a>00267                 <span class="keywordtype">int</span> index;
<a name="l00268"></a>00268                 <a class="code" href="definitions_8h.html#49d99d5115ac14e37e46ca5ce277ebe0">Schedule</a> tempSchedule;
<a name="l00269"></a>00269                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.size();i++){
<a name="l00270"></a>00270                         tempSchedule.clear();
<a name="l00271"></a>00271                         tempSchedule = <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.at(i);
<a name="l00272"></a>00272 <span class="comment">//                      fitness = island-&gt;getFitness(tempSchedule,kinOfFitness);</span>
<a name="l00273"></a>00273                         <span class="keywordflow">if</span>(island-&gt;<a class="code" href="classIsland.html#3bb216147816580b7be05b70b33d46a7">getFitness</a>(tempSchedule,kinOfFitness) &lt; fitness){
<a name="l00274"></a>00274                                 fitness = island-&gt;<a class="code" href="classIsland.html#3bb216147816580b7be05b70b33d46a7">getFitness</a>(tempSchedule,kinOfFitness);
<a name="l00275"></a>00275                                 index = i;
<a name="l00276"></a>00276                         }
<a name="l00277"></a>00277                 }
<a name="l00278"></a>00278 <span class="comment">//              cout &lt;&lt; "best fitness " &lt;&lt; fitness &lt;&lt; endl;</span>
<a name="l00279"></a>00279                 <span class="keywordflow">return</span> <a class="code" href="scheduler_8cpp.html#89008024daa9be0148f11458a7952eac">returnedSchedules</a>.at(index);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="scheduler_8cpp.html#6ecc9559b979dc1adcf49887f10c500e">00283</a> <span class="keywordtype">void</span> <a class="code" href="scheduler_8cpp.html#6ecc9559b979dc1adcf49887f10c500e">runSimulation</a>(){
<a name="l00284"></a>00284         <a class="code" href="scheduler_8cpp.html#3f1f91bcfdd5e5fa5af6a1887c28c490">numTasks</a> = 0;
<a name="l00285"></a>00285         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00286"></a>00286 <span class="comment">//              cout &lt;&lt; "Main: \n  -starting simulation with " &lt;&lt; numprocs &lt;&lt; " processors " &lt;&lt; " local population is set to "&lt;&lt; localPopulationSize&lt;&lt;endl;</span>
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289         <span class="comment">//first do some set up stuff</span>
<a name="l00290"></a>00290         
<a name="l00291"></a>00291 <span class="comment">//      srand(static_cast&lt;unsigned int&gt;(clock()) * myrank);</span>
<a name="l00292"></a>00292         
<a name="l00293"></a>00293         <span class="comment">//rank 0 creates the grid and broadcasts the resource list to the other</span>
<a name="l00294"></a>00294         <span class="comment">//nodes</span>
<a name="l00295"></a>00295         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00296"></a>00296                 <span class="comment">//create a new grid object. </span>
<a name="l00297"></a>00297                 g= <span class="keyword">new</span> <a class="code" href="classGrid.html">Grid</a>(<a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>);
<a name="l00298"></a>00298                 <span class="comment">//get the resource list</span>
<a name="l00299"></a>00299                 <a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a> = g-&gt;<a class="code" href="classGrid.html#5a1a2461b5e1654269bf138204883f9e">getResourceList</a>();
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <a class="code" href="scheduler_8cpp.html#1228f68b540116b0efd3d19a1353f732">packAndBroadcastResourceList</a>();
<a name="l00303"></a>00303         
<a name="l00304"></a>00304         <a class="code" href="scheduler_8cpp.html#4d3f97593b9627d0b198ebaf0d01199e">unpackResourceList</a>();
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">//create an island passing some constants for use later</span>
<a name="l00308"></a>00308         island = <span class="keyword">new</span> <a class="code" href="classIsland.html">Island</a>(<a class="code" href="scheduler_8cpp.html#5ec6ed8fc02fba98e9b6a5bfc098cf52">localPopulationSize</a>, <a class="code" href="scheduler_8cpp.html#775af73636d0d260322bc971582ffd7a">popInitMethod</a>, <a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">fitnessType</a>,<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         island-&gt;<a class="code" href="classIsland.html#837f70e3c5c14a7837397d3a68e6cddc">setCommunicator</a>(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>);  
<a name="l00311"></a>00311                 
<a name="l00312"></a>00312         island-&gt;<a class="code" href="classIsland.html#3e9779c062cf4a706f98665e5acbcb1f">setNeighbors</a>(<a class="code" href="scheduler_8cpp.html#036fdc4f6092f7315bbebcb44c4982f8">myLeft</a>,<a class="code" href="scheduler_8cpp.html#258abea066f11bbfcf28833da17afeb8">myRight</a>);
<a name="l00313"></a>00313 <span class="comment">//      island-&gt;setMyRank(myrank);</span>
<a name="l00314"></a>00314                         
<a name="l00315"></a>00315         <span class="comment">//then start the simulation n tings</span>
<a name="l00316"></a>00316         <span class="comment">//get time</span>
<a name="l00317"></a>00317 <span class="comment">//      if(gettimeofday(&amp;tp,NULL)==0 &amp;&amp; myrank==0){</span>
<a name="l00318"></a>00318 <span class="comment">//              sec=tp.tv_sec; usec=tp.tv_usec;</span>
<a name="l00319"></a>00319 <span class="comment">//      }</span>
<a name="l00320"></a>00320         MPI_Barrier(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>);
<a name="l00321"></a>00321         
<a name="l00322"></a>00322         
<a name="l00323"></a>00323         <span class="comment">//Start Timing</span>
<a name="l00324"></a>00324         <span class="keywordflow">if</span> (<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a> == 0){
<a name="l00325"></a>00325                 <a class="code" href="scheduler_8cpp.html#51233728f0f424bd44b30d50f54579a4">startwtime</a> = MPI_Wtime();
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327                 
<a name="l00328"></a>00328         <span class="comment">//the main control loop</span>
<a name="l00329"></a>00329         <span class="keywordflow">while</span> (<a class="code" href="scheduler_8cpp.html#3f1f91bcfdd5e5fa5af6a1887c28c490">numTasks</a> &lt; <a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">maxTasks</a>) {
<a name="l00330"></a>00330         
<a name="l00331"></a>00331                 <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>();    
<a name="l00332"></a>00332                 <span class="comment">//get a batch of jobs</span>
<a name="l00333"></a>00333                 vector&lt;double&gt; batch = <a class="code" href="scheduler_8cpp.html#e5df1a67ff8bf41dffc7ade8fbac38cf">getBatch</a>(<a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>); <span class="comment">//all                       </span>
<a name="l00334"></a>00334                 <span class="comment">//refresh resource list</span>
<a name="l00335"></a>00335                 <a class="code" href="scheduler_8cpp.html#d091007e4eadc8c285dc75c46b5e9261">refreshGridResourceList</a>(); <span class="comment">// rank 0            </span>
<a name="l00336"></a>00336                 <span class="comment">//get resource list and run scheduler </span>
<a name="l00337"></a>00337                                 
<a name="l00338"></a>00338                 <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a>.clear();
<a name="l00339"></a>00339                 <a class="code" href="scheduler_8cpp.html#434e697c73759b470b1a16869a6c185d">mySchedule</a> = island-&gt;<a class="code" href="classIsland.html#050abffb67894ba25878dd2c9ef44984">runGA</a>(<a class="code" href="scheduler_8cpp.html#eefd23002991be947f1986f89c360ca2">gridResourceList</a>, batch);<span class="comment">//all</span>
<a name="l00340"></a>00340                 <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(2);
<a name="l00341"></a>00341                 
<a name="l00342"></a>00342                 <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>();
<a name="l00343"></a>00343                 <span class="comment">//recive schdules and submit schedule to the grid </span>
<a name="l00344"></a>00344                 <a class="code" href="scheduler_8cpp.html#e64900c0f605f0ddc2b5de92d4c96d74">gatherSchdules</a>();
<a name="l00345"></a>00345                 <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(0);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347                 <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>();
<a name="l00348"></a>00348                 <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00349"></a>00349                         g-&gt;<a class="code" href="classGrid.html#c76034b3dfda5e61ddfad37613daa259">executeSchedule</a>(<a class="code" href="scheduler_8cpp.html#e0057189546a347c2f0b8eb30a0ea591">getBestSchedules</a>(<a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">fitnessType</a>), batch);<span class="comment">//rank 0</span>
<a name="l00350"></a>00350 <span class="comment">//                      update resource load data (a bit like a rtimestep)</span>
<a name="l00351"></a>00351                         g-&gt;<a class="code" href="classGrid.html#4f96d094e86b94ff7ab8e38e416954f8">updateResourceLoadData</a>(<a class="code" href="scheduler_8cpp.html#7c7a763fb2da35e937e10e35ae3d061a">getGaIterations</a>()); <span class="comment">// rank 0</span>
<a name="l00352"></a>00352 <span class="comment">// //                   write resource data to file</span>
<a name="l00353"></a>00353                         g-&gt;<a class="code" href="classGrid.html#4ad231bdb2750d553239273616e982bd">appendResourceUtilData</a>(); <span class="comment">//rank 0</span>
<a name="l00354"></a>00354                 }
<a name="l00355"></a>00355                 <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(1);
<a name="l00356"></a>00356                 
<a name="l00357"></a>00357                 <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>();
<a name="l00358"></a>00358                 <a class="code" href="scheduler_8cpp.html#1228f68b540116b0efd3d19a1353f732">packAndBroadcastResourceList</a>();
<a name="l00359"></a>00359                 <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(0);
<a name="l00360"></a>00360                 
<a name="l00361"></a>00361                 <a class="code" href="scheduler_8cpp.html#b99d79a1c9b0f3027eb43a622b958a84">timeStart</a>();
<a name="l00362"></a>00362                 <a class="code" href="scheduler_8cpp.html#4d3f97593b9627d0b198ebaf0d01199e">unpackResourceList</a>();   
<a name="l00363"></a>00363                 <a class="code" href="scheduler_8cpp.html#25d3a217c1a8c01e5fc4964f0db5b7e6">timeEnd</a>(1);
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="comment">//get time again and calculate execution time</span>
<a name="l00367"></a>00367         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00368"></a>00368                 <span class="keywordflow">if</span>(gettimeofday(&amp;<a class="code" href="scheduler_8cpp.html#9dff64e43945ca6cb1a16d4bc2d3a48f">tp</a>,NULL)==0){
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="comment">//                      sec=tp.tv_sec-sec; usec=tp.tv_usec-usec;</span>
<a name="l00371"></a>00371 <span class="comment">// </span>
<a name="l00372"></a>00372 <span class="comment">//                      td=sec+usec/1.0e6;</span>
<a name="l00373"></a>00373                         <a class="code" href="scheduler_8cpp.html#58d76b19928bb7b37adbb4f4ba9d2ad5">endwtime</a> = MPI_Wtime();
<a name="l00374"></a>00374                         <a class="code" href="scheduler_8cpp.html#bc276e47b85df9dd59f248e663b3b971">total_time</a> = <a class="code" href="scheduler_8cpp.html#58d76b19928bb7b37adbb4f4ba9d2ad5">endwtime</a> - <a class="code" href="scheduler_8cpp.html#51233728f0f424bd44b30d50f54579a4">startwtime</a>;
<a name="l00375"></a>00375                         
<a name="l00376"></a>00376                         cout &lt;&lt; <a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a> &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; <a class="code" href="scheduler_8cpp.html#bc276e47b85df9dd59f248e663b3b971">total_time</a> &lt;&lt; endl;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">//                      cout &lt;&lt; "Sceduler time measures"&lt;&lt; endl;</span>
<a name="l00379"></a>00379 <span class="comment">//                      cout &lt;&lt; numprocs &lt;&lt;"    total_time:" &lt;&lt; total_time &lt;&lt; " t_init:"&lt;&lt; t_init &lt;&lt; " t_comp:"&lt;&lt; t_comp &lt;&lt; " t_comm:" &lt;&lt; t_comm &lt;&lt; " run ga:"&lt;&lt; t_compRunGA &lt;&lt;" sum:"&lt;&lt; (t_init+t_comp+t_comm+t_compRunGA) &lt;&lt;endl;</span>
<a name="l00380"></a>00380 <span class="comment">//                      cout &lt;&lt; "Island time measures"&lt;&lt; endl;</span>
<a name="l00381"></a>00381 <span class="comment">//                      cout &lt;&lt; "       T_init:" &lt;&lt; island-&gt;getT_init() &lt;&lt; " T_comp:"&lt;&lt; island-&gt;getT_comp() &lt;&lt;" T_comm:" &lt;&lt;island-&gt;getT_comm() &lt;&lt; " sum:"&lt;&lt;(island-&gt;getT_init() + island-&gt;getT_comp() + island-&gt;getT_comm())&lt;&lt; endl;</span>
<a name="l00382"></a>00382 <span class="comment">//                      cout &lt;&lt; "GATimes"&lt;&lt; endl;</span>
<a name="l00383"></a>00383 <span class="comment">//                      cout &lt;&lt; "       selection:" &lt;&lt; island-&gt;getT_compGA()[0] &lt;&lt; " Xover:"&lt;&lt; island-&gt;getT_compGA()[1] &lt;&lt;" mutation:" &lt;&lt;island-&gt;getT_compGA()[2] &lt;&lt; "  natural Selection:" &lt;&lt; island-&gt;getT_compGA()[3]  &lt;&lt; " fitness eval:"&lt;&lt; island-&gt;getT_compFitnessEval()&lt;&lt;" sum:"&lt;&lt; (island-&gt;getT_compGA()[0]+island-&gt;getT_compGA()[1]+island-&gt;getT_compGA()[2]+island-&gt;getT_compGA()[3]+island-&gt;getT_compFitnessEval()) &lt;&lt; endl;</span>
<a name="l00384"></a>00384                         
<a name="l00385"></a>00385 <span class="comment">//                      cout &lt;&lt; " Iterartons:" &lt;&lt; getGaIterations() &lt;&lt; " LocalPop:"&lt;&lt; localPopulationSize &lt;&lt;endl;</span>
<a name="l00386"></a>00386                 }
<a name="l00387"></a>00387                 g-&gt;<a class="code" href="classGrid.html#3661d0a7f998caaaf8627d7a67072116">~Grid</a>();
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a><a class="code" href="scheduler_8cpp.html#0d5f32e277578aaab794784d30bfe53d">00392</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#0d5f32e277578aaab794784d30bfe53d">parseargs</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
<a name="l00393"></a>00393         
<a name="l00394"></a>00394         <span class="keywordtype">int</span> check_options = 0;
<a name="l00395"></a>00395         <span class="keywordtype">char</span> opt;
<a name="l00396"></a>00396         
<a name="l00397"></a>00397         <span class="comment">/* Check options */</span>
<a name="l00398"></a>00398         <span class="keywordflow">while</span> (EOF != (opt =  getopt(argc, argv, <span class="stringliteral">"r:t:p:b:i:f:"</span>) )) {  
<a name="l00399"></a>00399                 <span class="keywordflow">switch</span> (opt) {
<a name="l00400"></a>00400                         
<a name="l00401"></a>00401                 <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
<a name="l00402"></a>00402                         <span class="comment">//get argument from argv, I think</span>
<a name="l00403"></a>00403                         <a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a> = atoi(optarg);
<a name="l00404"></a>00404                         <span class="comment">//check that it's a valid argument</span>
<a name="l00405"></a>00405                         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a> &gt; 1) check_options += 1;
<a name="l00406"></a>00406 <span class="comment">//                      cout &lt;&lt; "numResources set to: " &lt;&lt; numResources &lt;&lt; endl;</span>
<a name="l00407"></a>00407 <span class="comment">//                      arguments[0] = numResources;</span>
<a name="l00408"></a>00408                         <span class="keywordflow">break</span>;
<a name="l00409"></a>00409                 <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
<a name="l00410"></a>00410                         <span class="comment">//get argument from argv, I think</span>
<a name="l00411"></a>00411                         <a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">maxTasks</a> = atoi(optarg);
<a name="l00412"></a>00412                         <span class="comment">//check that it's a valid argument</span>
<a name="l00413"></a>00413                         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">maxTasks</a> &gt; 1) check_options += 2;
<a name="l00414"></a>00414 <span class="comment">//                      cout &lt;&lt; "maxTasks set to: " &lt;&lt; maxTasks &lt;&lt; endl;</span>
<a name="l00415"></a>00415 <span class="comment">//                      arguments[1] = maxTasks;</span>
<a name="l00416"></a>00416                         <span class="keywordflow">break</span>;
<a name="l00417"></a>00417                 <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
<a name="l00418"></a>00418                         <span class="comment">//get argument from argv, I think</span>
<a name="l00419"></a>00419                         <a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a> = atoi(optarg);
<a name="l00420"></a>00420                         <span class="comment">//check that it's a valid argument</span>
<a name="l00421"></a>00421                         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a> &gt; 1) check_options += 4;
<a name="l00422"></a>00422 <span class="comment">//                      cout &lt;&lt; "populationSize set to: " &lt;&lt; populationSize &lt;&lt; endl;</span>
<a name="l00423"></a>00423 <span class="comment">//                      arguments[2] = populationSize;</span>
<a name="l00424"></a>00424                         <span class="keywordflow">break</span>;
<a name="l00425"></a>00425                         
<a name="l00426"></a>00426                 <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
<a name="l00427"></a>00427                         <span class="comment">//get argument from argv, I think</span>
<a name="l00428"></a>00428                         <a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a> = atoi(optarg);
<a name="l00429"></a>00429                         <span class="comment">//check that it's a valid argument</span>
<a name="l00430"></a>00430                         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a> &gt; 1) check_options += 8;
<a name="l00431"></a>00431 <span class="comment">//                      cout &lt;&lt; "batchSize set to: " &lt;&lt; batchSize &lt;&lt; endl;</span>
<a name="l00432"></a>00432 <span class="comment">//                      arguments[3] = batchSize;</span>
<a name="l00433"></a>00433                         <span class="keywordflow">break</span>;
<a name="l00434"></a>00434                 <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
<a name="l00435"></a>00435                         <span class="comment">//get argument from argv, I think</span>
<a name="l00436"></a>00436                         <a class="code" href="scheduler_8cpp.html#775af73636d0d260322bc971582ffd7a">popInitMethod</a> = atoi(optarg);
<a name="l00437"></a>00437                         <span class="comment">//check that it's a valid argument</span>
<a name="l00438"></a>00438                         check_options += 15;
<a name="l00439"></a>00439 <span class="comment">//                      cout &lt;&lt; "popInitMeth set to: " &lt;&lt; popInitMethod &lt;&lt; endl;</span>
<a name="l00440"></a>00440 <span class="comment">//                      arguments[4] =popInitMethod;</span>
<a name="l00441"></a>00441                         <span class="keywordflow">break</span>;
<a name="l00442"></a>00442                 <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
<a name="l00443"></a>00443                         <span class="comment">//get argument from argv, I think</span>
<a name="l00444"></a>00444                         <a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">fitnessType</a> = atoi(optarg);
<a name="l00445"></a>00445                         <span class="comment">//check that it's a valid argument</span>
<a name="l00446"></a>00446                         check_options += 30;
<a name="l00447"></a>00447 <span class="comment">//                      cout &lt;&lt; "fitness type set to: " &lt;&lt; fitnessType &lt;&lt; endl;</span>
<a name="l00448"></a>00448 <span class="comment">//                      arguments[5] = fitnessType;</span>
<a name="l00449"></a>00449                         <span class="keywordflow">break</span>;
<a name="l00450"></a>00450                         
<a name="l00451"></a>00451                 <span class="keywordflow">default</span>:
<a name="l00452"></a>00452 <span class="comment">//                      cout &lt;&lt; "Usage: -r &lt;num_resources&gt;" &lt;&lt; endl;</span>
<a name="l00453"></a>00453                         exit(EXIT_FAILURE);
<a name="l00454"></a>00454                         <span class="keywordflow">break</span>;
<a name="l00455"></a>00455                 }
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457         
<a name="l00458"></a>00458         <span class="comment">/* Check if all needed options have been set */</span>
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (check_options != 60) {
<a name="l00460"></a>00460                 <span class="comment">//If required arguments are not supplied print usage and quit</span>
<a name="l00461"></a>00461 <span class="comment">//              cout &lt;&lt; "Usage: -r &lt;num_resources&gt; -p &lt;populationSize&gt; -b &lt;batchSize&gt; -i &lt;initialisation(int)&gt; -f &lt;fitnessType(int)&gt;" &lt;&lt; endl;</span>
<a name="l00462"></a>00462                 <span class="comment">//exit(EXIT_FAILURE);</span>
<a name="l00463"></a>00463         }
<a name="l00464"></a>00464         <span class="keywordflow">return</span> 0;
<a name="l00465"></a>00465 }<span class="comment">//end parseargs</span>
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="scheduler_8cpp.html#0ddf1224851353fc92bfbff6f499fa97">00467</a> <span class="keywordtype">int</span> <a class="code" href="scheduler_8cpp.html#0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]){
<a name="l00468"></a>00468         MPI_Init(&amp;argc, &amp;argv);
<a name="l00469"></a>00469         MPI_Comm_size(MPI_COMM_WORLD, &amp;<a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a>);
<a name="l00470"></a>00470         MPI_Comm_rank(MPI_COMM_WORLD, &amp;<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>);
<a name="l00471"></a>00471         
<a name="l00472"></a>00472         <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>==0){
<a name="l00473"></a>00473                 <span class="keywordflow">if</span>(<a class="code" href="scheduler_8cpp.html#0d5f32e277578aaab794784d30bfe53d">parseargs</a>(argc, argv)) { 
<a name="l00474"></a>00474                         MPI_Abort(MPI_COMM_WORLD, EXIT_FAILURE); 
<a name="l00475"></a>00475                         exit(EXIT_FAILURE); 
<a name="l00476"></a>00476                 }                               
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         
<a name="l00479"></a>00479         <span class="comment">// Brodcast arguments to the nodes</span>
<a name="l00480"></a>00480         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a>, 1,MPI_INT,0,MPI_COMM_WORLD);
<a name="l00481"></a>00481         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#e1308bf8270beedf52432b840eac4beb">batchSize</a>, 1, MPI_INT, 0,MPI_COMM_WORLD );
<a name="l00482"></a>00482         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#df4ccfc6f6d01037696d44237736d0ac">numResources</a>, 1, MPI_INT, 0,MPI_COMM_WORLD );
<a name="l00483"></a>00483         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#775af73636d0d260322bc971582ffd7a">popInitMethod</a>, 1, MPI_INT, 0,MPI_COMM_WORLD );
<a name="l00484"></a>00484         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#3a61151e1751fcede4c4fd1705f7ca56">fitnessType</a>, 1, MPI_INT, 0,MPI_COMM_WORLD );
<a name="l00485"></a>00485         MPI_Bcast ( &amp;<a class="code" href="scheduler_8cpp.html#201944c0580ebbd037ff80579144ebaf">maxTasks</a>, 1, MPI_INT, 0,MPI_COMM_WORLD );
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         
<a name="l00488"></a>00488 <span class="comment">//      if (myrank==1){</span>
<a name="l00489"></a>00489 <span class="comment">//              localPopulationSize = (populationSize/numprocs) + (populationSize%numprocs) ;</span>
<a name="l00490"></a>00490 <span class="comment">//      }</span>
<a name="l00491"></a>00491 <span class="comment">//      else{</span>
<a name="l00492"></a>00492 <span class="comment">//              localPopulationSize = populationSize/numprocs;</span>
<a name="l00493"></a>00493 <span class="comment">//      }</span>
<a name="l00494"></a>00494         <span class="keywordflow">if</span> (<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>&lt;<a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a>%<a class="code" href="scheduler_8cpp.html#31bfe068640b411bea3df0d69177ded5">numprocs</a>){
<a name="l00495"></a>00495                 <a class="code" href="scheduler_8cpp.html#5ec6ed8fc02fba98e9b6a5bfc098cf52">localPopulationSize</a> = (<a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a>/numprocs) +1;
<a name="l00496"></a>00496         }<span class="keywordflow">else</span>{
<a name="l00497"></a>00497                 <a class="code" href="scheduler_8cpp.html#5ec6ed8fc02fba98e9b6a5bfc098cf52">localPopulationSize</a> = <a class="code" href="scheduler_8cpp.html#2d9fb649fcb8ba7492b3f24451bee021">populationSize</a>/numprocs;
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499                 
<a name="l00500"></a>00500         <a class="code" href="scheduler_8cpp.html#0fcb2205a2bd023d3d00a55f0cf487b1">initResourceStruct</a>();
<a name="l00501"></a>00501                 
<a name="l00502"></a>00502         <a class="code" href="scheduler_8cpp.html#9b908a290e469965b0988ee6ab9782dd">dims</a>[0] = numprocs;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="comment">//0 for line topology, 1 for ring topology</span>
<a name="l00505"></a>00505         <a class="code" href="scheduler_8cpp.html#2c2f810d1261b151f4e2159f9412d1a2">periods</a>[0] = 1; 
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="comment">//cretae a ring totpology to impruve prrformnce </span>
<a name="l00509"></a>00509         MPI_Cart_create(MPI_COMM_WORLD, 1, <a class="code" href="scheduler_8cpp.html#9b908a290e469965b0988ee6ab9782dd">dims</a>, <a class="code" href="scheduler_8cpp.html#2c2f810d1261b151f4e2159f9412d1a2">periods</a>, 1, &amp;<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>);
<a name="l00510"></a>00510         
<a name="l00511"></a>00511         <span class="comment">//get new rank</span>
<a name="l00512"></a>00512         MPI_Comm_rank(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>, &amp;<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         
<a name="l00515"></a>00515         <span class="comment">//get coordinates </span>
<a name="l00516"></a>00516         MPI_Cart_get(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>,1,<a class="code" href="scheduler_8cpp.html#9b908a290e469965b0988ee6ab9782dd">dims</a>,<a class="code" href="scheduler_8cpp.html#2c2f810d1261b151f4e2159f9412d1a2">periods</a>,<a class="code" href="scheduler_8cpp.html#75550a3b9f4547372b09aa2f0f1e9941">coords</a>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         
<a name="l00519"></a>00519         <span class="keywordtype">int</span> lcoord[<a class="code" href="scheduler_8cpp.html#9b908a290e469965b0988ee6ab9782dd">dims</a>[0]];
<a name="l00520"></a>00520         <span class="keywordtype">int</span> rcoord[dims[0]];
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         lcoord[0] = <a class="code" href="scheduler_8cpp.html#75550a3b9f4547372b09aa2f0f1e9941">coords</a>[0]-1;
<a name="l00523"></a>00523         rcoord[0] = <a class="code" href="scheduler_8cpp.html#75550a3b9f4547372b09aa2f0f1e9941">coords</a>[0]+1;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         <span class="comment">//left right nodes</span>
<a name="l00526"></a>00526         MPI_Cart_rank(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>,lcoord,&amp;<a class="code" href="scheduler_8cpp.html#036fdc4f6092f7315bbebcb44c4982f8">myLeft</a>);
<a name="l00527"></a>00527         MPI_Cart_rank(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>,rcoord,&amp;<a class="code" href="scheduler_8cpp.html#258abea066f11bbfcf28833da17afeb8">myRight</a>);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         
<a name="l00530"></a>00530 <span class="comment">//      myRight = (myrank + 1) % numprocs;</span>
<a name="l00531"></a>00531 <span class="comment">//      myLeft = myrank - 1;</span>
<a name="l00532"></a>00532 <span class="comment">//      if (myLeft &lt; 0)</span>
<a name="l00533"></a>00533 <span class="comment">//              myLeft = numprocs - 1;</span>
<a name="l00534"></a>00534         
<a name="l00535"></a>00535         srandom(31416+10*(<a class="code" href="scheduler_8cpp.html#a8a2431e50f9fc7d8c78af300d5f3bee">myrank</a>));
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="comment">//      ring = MPI_COMM_WORLD;</span>
<a name="l00538"></a>00538                 
<a name="l00539"></a>00539         MPI_Barrier(<a class="code" href="scheduler_8cpp.html#71d5d125ae084279ea8161c78c229b0f">ring</a>);
<a name="l00540"></a>00540         
<a name="l00541"></a>00541         <a class="code" href="scheduler_8cpp.html#6ecc9559b979dc1adcf49887f10c500e">runSimulation</a>();
<a name="l00542"></a>00542         
<a name="l00543"></a>00543         MPI_Finalize();
<a name="l00544"></a>00544         <span class="keywordflow">return</span> EXIT_SUCCESS;
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 17 11:46:31 2007 for Grid schduling Simulation sequential by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
